<!DOCTYPE html>
<html>
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Big+Shoulders:opsz,wght@10..72,100..900&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        margin: 0;
        padding: 0;
        background: #000;
      }
      #messages {
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: calc(100% - 50px);
        background: #393e46;
        overflow-y: auto;
        padding: 10px;
        box-sizing: border-box;
        font-family: sans-serif;
      }
      #sendMsg {
        position: fixed;
        left: 0;
        bottom: 0;
        width: 100%;
        height: 50px;
        background: #aaa;
        font-family: "Big Shoulders", sans-serif;
      }
      #msgTxt {
        position: absolute;
        left: 0;
        top: 0;
        width: calc(100% - 100px);
        height: 100%;
        padding-left: 10px;
        box-sizing: border-box;
        background-color: #222831;
        color: #00adb5;
        font-family: "Big Shoulders", sans-serif;
        border: none;
      }
      #msgBtn {
        position: absolute;
        right: 0;
        top: 0;
        width: 100px;
        height: 100%;
        background-color: #222831;
        color: #00adb5;
        font-family: "Big Shoulders", sans-serif;
        font-size: 15px;
        border: none;
        border-left: solid 2px;
        border-radius: 0px;
      }
      .outer {
        width: 100%;
        margin-top: 10px;
        display: flex;
      }
      #inner {
        padding: 10px;
        box-sizing: border-box;
        border-radius: 10px;
        color: #eeeeee;
        background-color: #222831;
      }
      .me {
        background: #8800ff;
        color: #fff;
      }
      .notMe {
        background: #fff;
        color: #000;
      }
    </style>
  </head>

  <body>
    <div id="messages"></div>

    <div id="sendMsg">
      <input type="text" id="msgTxt" placeholder="ENTER YOUR MSG..." />
      <input
        type="submit"
        id="msgBtn"
        value="SEND"
        onclick="module.sendMsg()"
      />
    </div>

    <script>
      module = {};
    </script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        set,
        remove,
        onChildAdded,
        onChildRemoved,
      } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBCQpRAaUoUG4UyE4D9nVMHKh4fxz9uzoo",
        projectId: "chat-app-77771",
        storageBucket: "chat-app-77771.firebasestorage.app",
        messagingSenderId: "943621496980",
        authDomain: "chat-app-77771.firebaseapp.com",
        appId: "1:943621496980:web:a8d50488822243c7e11481",
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);

      // variables
      var msgTxt = document.getElementById("msgTxt");
      var sender;
      if (sessionStorage.getItem("sender")) {
        sender = sessionStorage.getItem("sender");
      } else {
        sender = prompt("PLEASE ENTER YOUR NAME");
        sessionStorage.setItem("sender", sender);
      }

      // TO SEND MESSAGES
      module.sendMsg = function sendMsg() {
        var msg = msgTxt.value;
        var timestamp = new Date().getTime();
        set(ref(db, "messages/" + timestamp), {
          msg: msg,
          sender: sender,
        });

        msgTxt.value = "";
      };

      // TO RECEIVE MSG
      onChildAdded(ref(db, "messages"), (data) => {
        if (data.val().sender == sender) {
          messages.innerHTML +=
            "<div style=justify-content:end class=outer id=" +
            data.key +
            "><div id=inner class=me>you : " +
            data.val().msg +
            "<button id=dltMsg onclick=module.dltMsg(" +
            data.key +
            ")>DELETE</button></div></div>";
        } else {
          messages.innerHTML +=
            "<div class=outer id=" +
            data.key +
            "><div id=inner class=notMe>" +
            data.val().sender +
            " : " +
            data.val().msg +
            "</div></div>";
        }
      });

      // TO DELETE MSG
      module.dltMsg = function dltMsg(key) {
        remove(ref(db, "messages/" + key));
      };

      // WHEN MSG IS DELETED
      onChildRemoved(ref(db, "messages"), (data) => {
        var msgBox = document.getElementById(data.key);
        messages.removeChild(msgBox);
      });
    </script>
  </body>
</html>
